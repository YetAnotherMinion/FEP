\documentclass{article}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{graphicx}
\graphicspath{ {../../images/} }
\usepackage{amssymb}
\usepackage{adjustbox}
\usepackage{placeins}
\usepackage{geometry}
\usepackage{epstopdf}
\geometry{tmargin = 1in}

% Alter some LaTeX defaults for better treatment of figures:
    % See p.105 of "TeX Unbound" for suggested values.
    % See pp. 199-200 of Lamport's "LaTeX" book for details.
    %   General parameters, for ALL pages:
    \renewcommand{\topfraction}{0.9}    % max fraction of floats at top
    \renewcommand{\bottomfraction}{0.8} % max fraction of floats at bottom
    %   Parameters for TEXT pages (not float pages):
    \setcounter{topnumber}{2}
    \setcounter{bottomnumber}{2}
    \setcounter{totalnumber}{4}     % 2 may work better
    \setcounter{dbltopnumber}{2}    % for 2-column pages
    \renewcommand{\dbltopfraction}{0.9} % fit big float above 2-col. text
    \renewcommand{\textfraction}{0.07}  % allow minimal text w. figs
    %   Parameters for FLOAT pages (not text pages):
    \renewcommand{\floatpagefraction}{0.7}  % require fuller float pages
    % N.B.: floatpagefraction MUST be less than topfraction !!
    \renewcommand{\dblfloatpagefraction}{0.7}   % require fuller float pages

\usepackage{color}
\usepackage{xcolor}
\usepackage{listings}
\lstset{
  language= C++,
        % basicstyle=\scriptsize,
        % aboveskip={1.5\baselineskip},
        % columns=fixed,
        showstringspaces=false,
        % extendedchars=false,
        breaklines=true,
        % prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
        frame=single,
        numbers=left,
        showtabs=false,
        tabsize=3,
        % showspaces=false,
        % showstringspaces=false,
        keywordstyle=\color[HTML]{FF1F54},
        commentstyle=\color[HTML]{008507},
        stringstyle=\color[HTML]{EFAE21},
        numberstyle= \color[HTML]{000000}
}

\renewcommand{\algorithmicforall}{\textbf{for each}}

\begin{document}
\title{Assignment 4: Finite Elements Programming}
%\date{}   
\author{Isaiah Bell} 
\maketitle

\section{Methods}

In this code we solve 2D linear elastic problems over isotropic materials.


\section{Program Design}

The Parallel Unstructured Mesh Infrastructure (PUMI) library was heavily plundered to develop this FE code. A native PUMI mesh was used to represent the discretization of the geometrical model. 

The geometrical model definition of the problem is implemented in an embedded Domain Specific Language implemented in C++. Each mesh is generated by operations in this DSL. The shape and size is specified first to create the physical mesh. During the generation of the mesh over the specified geometrical domain, the individual mesh entities are annotated with their corresponding geometrical entities. While PUMI has the capability to import meshes associated with an annotated geometry model, this import capability relies on the output of proprietary software. 

The class ElasticAnalysis2D is derived from the base FEAnalysis class and implements
our specific linear elastics definition. This class accepts a PUMI mesh and makes
several assumptions about the mesh structure to determine boundary conditions and
tractions.

For memory efficiency the algebraic system is assembled as we iterate over all of the
mesh elements. Assembly is simplified by the fact we are using isoparametric elements

We extend the apf::Integrator class to implement each stiffness contributor, as well as the discretization of each traction.


\section{Tests}

\subsection{No Boundary Constraints, No Tractions}


\subsection{Zero Displacement Boundary Conditions, No Tractions}



\subsection{Some Boundary Constraints, Simple Linear Traction}

\subsection{Some Boundary Constraints, Simple Body Force}
\FloatBarrier

\begin{figure}
    \makebox[\textwidth][c]{\adjustbox{trim= {0.1\width} {0.10\height} {0} {0.25\height}, clip}{\includegraphics[width = \textwidth ]{gravity_linear_quad}}};
    \caption{Linear quadrilateral mesh for a 2 unit by 1 unit rectangular plane shown with displacement scaled by $50,000$ times}
\centering
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\adjustbox{trim= {0.1\width} {0.10\height} {0} {0.25\height}, clip}{\includegraphics[width = \textwidth ]{gravity_linear_tri}}};
    \caption{Linear triangle mesh for a 2 unit by 1 unit rectangular plane shown with displacement scaled by $50,000$ times}
\centering
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\adjustbox{trim= {0.1\width} {0.10\height} {0} {0.25\height}, clip}{\includegraphics[width = \textwidth ]{gravity_quadratic_quad}}};
    \caption{Quadratic quadrilateral mesh for a 2 unit by 1 unit rectangular plane shown with displacement scaled by $50,000$ times}
\centering
\end{figure}


% \begin{figure}
%     \makebox[\textwidth][c]{\adjustbox{trim= {0.1\width} {0.10\height} {0} {0.25\height}, clip}{\includegraphics[width = \textwidth ]{gravity_linear_quad}}};
%     \caption{Quadratic triangle mesh for a 2 unit by 1 unit rectangular plane shown with displacement scaled by $50,000$ times}
% \centering
% \end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\adjustbox{trim= {0.1\width} {0.10\height} {0} {0.25\height}, clip}{\includegraphics[width = \textwidth ]{gravity_serendipity_quad}}};
    \caption{Serendipity mesh for a 2 unit by 1 unit rectangular plane shown with displacement scaled by $50,000$ times}
\centering
\end{figure}


\FloatBarrier

\subsection{Some Boundary Constraints, Tractions and Body Forces}

\subsection{Fully Constrained with Zero Displacements with Body Forces}


\section{Notable Bugs}

\FloatBarrier

\begin{figure}
    \makebox[\textwidth][c]{\adjustbox{trim= {0} {0.2\height} {0} {0.15\height}, clip}{\includegraphics[width = 0.8\textwidth ]{smaller_h_constant_force}}};
    \caption{Convergence of different mesh elements for same boundary value problem with a constant body force as seen in the }
\centering
\end{figure}

This error with the strain energy is

\begin{figure}
    \makebox[\textwidth][c]{\adjustbox{trim= {0} {0.2\height} {0} {0.15\height}, clip}{\includegraphics[width = 0.8\textwidth ]{smaller_h_constant_force_20x20}}};
    \caption{Convergence of different mesh elements for same boundary value problem with a constant body force as seen in the }
\centering
\end{figure}

\FloatBarrier
\section{Pseudo code}

Not completed

% \begin{algorithm}
% \begin{algorithmic}

% \Procedure{Foo}{bar}
%     \State Foo
% \EndProcedure

% \end{algorithmic}
% \end{algorithm}

% \begin{algorithm}
% \begin{algorithmic}

% \Procedure{IntegrateStiffness}{element, weight, dV}
%     \State n\_local\_dofs $\gets$ NDIM $*$ countElementNodes(element) \Comment{2} 
%     \State K\_element $\gets$ Matrix< n\_local\_dofs, n\_local\_dofs >
%     \ForAll{integration\_point \textbf{on} element}
%         \State gradShape $\gets$ getShapeGradient(integration\_point)
%         \Comment Construct
%         \ForAll{node \textbf{in} element}
%             \State B[node\_index] $\gets$ $ \left[  \right]$
%         \EndFor
%     \EndFor
% \EndProcedure

% \end{algorithmic}
% \end{algorithm}



% \begin{figure}
%     \makebox[\textwidth][c]{\adjustbox{trim= {0.15\width} {0} {0.15\width} {0}, clip}{\includegraphics[width = \textwidth ]{part1_pre_migr}}};
%     \caption{Partition 1 surface before region migration}
% \centering


\section{Source Code Listings}

\lstset{linewidth = 16cm, xrightmargin = 0cm}
\lstlistoflistings
\lstinputlisting[caption = {Test Driver}]{../src/a4.cc}
%includes
\lstinputlisting[caption = {Algebraic System container class}]{../inc/AlgebraicSystem.h}
\lstinputlisting[caption = {Elastic Analysis Class}]{../inc/ElasticAnalysis2D.h}
\lstinputlisting[caption = {Abstract Base FE Analysis class}]{../inc/FEAnalysis.h}
\lstinputlisting[caption = {Force Contributor}]{../inc/ForceContributor2D.h}
\lstinputlisting[caption = {Mesh Builder helper class}]{../inc/MeshBuilder.h}
\lstinputlisting[caption = {Adjacency reordering routine}]{../inc/MeshAdjReorder.h}
\lstinputlisting[caption = {Stiffness Constributor}]{../inc/StiffnessContributor2D.h}
\lstinputlisting[caption = {Recover Secondary Variables}]{../inc/RecoverAtIntegrationPoints.h}


%sources
\lstinputlisting[caption = {Algebraic System implementation}]{../src/AlgebraicSystem.cc}
\lstinputlisting[caption = {Elastic Analysis implementation}]{../src/ElasticAnalysis2D.cc}
\lstinputlisting[caption = {Force Contributor implementation}]{../src/ForceContributor2D.cc}

\lstinputlisting[caption = {Stiffness contributor implementation}]{../src/StiffnessContributor2D.cc}
\lstinputlisting[caption = {Geometry Mapping Implementation}]{../src/GeometryMappings.cc}
\lstinputlisting[caption = {Mesh Adjacency reordering implementation}]{../src/MeshAdjReorder.cc}
\lstinputlisting[caption = {Mesh builder scripts}]{../src/MeshBuilder.cc}

%tests

%Mesh builder unittests are all empty right now and probably wont meaningfully change
%\lstinputlisting[caption = {Mesh builder unittests}]{../src/MeshBuilder_unittest.cc}
\lstinputlisting[caption = {Algebraic System tests}]{../src/AlgebraicSystem_unittest.cc}
\lstinputlisting[caption = {Test node mapping functions}]{../src/ShapeFunctionOrdering_unittest.cc}
\lstinputlisting[caption = {Test mesh generation scripts}]{../src/SimpleRectMesh_unittest.cc}
\lstinputlisting[caption = {Geometry Mapping tests}]{../src/GeometryMappings_unittest.cc}

%build files
\lstinputlisting[caption = {configuration file}]{../config.mk}
\lstinputlisting[caption = {Makefile}]{../Makefile}
\lstinputlisting[caption = {Travis CI}] {../../.travis.yml}


\end{document}
